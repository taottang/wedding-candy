<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="å¡«å†™å–œç³–é¢†å–ä¿¡æ¯">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <title>å¡«å†™é¢†å–ä¿¡æ¯ - é‚“è““ & å”éŸ¬</title>
    
    <!-- ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ -->
    <link rel="stylesheet" href="css/mobile.min.css">
    
    <style>
        /* ==================== å…¨å±€æ ·å¼ ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #FFE6E6;
            --accent-color: #E8B4B8;
            --text-color: #5D4037;
            --light-bg: #FFF5F5;
            --white: #FFFFFF;
            --error-color: #D32F2F;
            --success-color: #388E3C;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Hiragino Sans GB', sans-serif;
            color: var(--text-color);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--light-bg) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* ==================== å®¹å™¨ ==================== */
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* ==================== é¡µé¢å¤´éƒ¨ ==================== */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--accent-color);
            text-decoration: none;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            transform: translateX(-5px);
        }
        
        .page-title {
            font-size: 2.5rem;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .page-subtitle {
            font-size: 1.1rem;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        /* ==================== æ­¥éª¤æŒ‡ç¤ºå™¨ ==================== */
        .steps-indicator {
            background: var(--white);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(93, 64, 55, 0.08);
            animation: fadeIn 0.8s ease-out 0.2s both;
        }
        
        .steps-track {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .steps-track::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 25px;
            right: 25px;
            height: 3px;
            background: var(--primary-color);
            z-index: 1;
        }
        
        .step-progress {
            position: absolute;
            top: 25px;
            left: 25px;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            z-index: 2;
            transition: width 0.5s ease;
        }
        
        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
            flex: 1;
        }
        
        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--white);
            border: 3px solid var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .step-item.active .step-circle {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            border-color: var(--accent-color);
            color: var(--white);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(232, 180, 184, 0.4);
        }
        
        .step-item.completed .step-circle {
            background: var(--success-color);
            border-color: var(--success-color);
            color: var(--white);
        }
        
        .step-label {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-color);
            text-align: center;
        }
        
        .step-item.active .step-label {
            font-weight: 600;
            color: var(--accent-color);
        }
        
        /* ==================== è¡¨å•å¡ç‰‡ ==================== */
        .form-card {
            background: var(--white);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(93, 64, 55, 0.1);
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }
        
        .step-title {
            font-size: 1.8rem;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .step-description {
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        /* ==================== è¡¨å•ç»„ ==================== */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .required {
            color: var(--error-color);
            margin-left: 3px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            color: var(--text-color);
            background: var(--white);
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(232, 180, 184, 0.1);
        }
        
        .form-control.error {
            border-color: var(--error-color);
            background: rgba(211, 47, 47, 0.05);
        }
        
        .form-control.success {
            border-color: var(--success-color);
        }
        
        select.form-control {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%235D4037' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }
        
        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-hint {
            display: block;
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.6;
            margin-top: 5px;
        }
        
        .error-message {
            display: block;
            color: var(--error-color);
            font-size: 0.85rem;
            margin-top: 5px;
            min-height: 20px;
        }
        
        .error-message:empty {
            display: none;
        }
        
        .char-counter {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.6;
            margin-top: 5px;
        }
        
        /* ==================== è¡Œå¸ƒå±€ ==================== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        /* ==================== é¢„è§ˆå¡ç‰‡ ==================== */
        .preview-card {
            background: var(--light-bg);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .preview-section {
            margin-bottom: 20px;
        }
        
        .preview-section:last-child {
            margin-bottom: 0;
        }
        
        .preview-section-title {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .preview-item {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid rgba(93, 64, 55, 0.1);
        }
        
        .preview-item:last-child {
            border-bottom: none;
        }
        
        .preview-label {
            font-weight: 500;
            color: var(--text-color);
            min-width: 120px;
        }
        
        .preview-value {
            color: var(--text-color);
            flex: 1;
        }
        
        /* ==================== å¤é€‰æ¡† ==================== */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .checkbox-input {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--accent-color);
            margin-top: 2px;
        }
        
        .checkbox-label {
            flex: 1;
            font-size: 0.95rem;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .checkbox-label a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
        }
        
        .checkbox-label a:hover {
            text-decoration: underline;
        }
        
        /* ==================== æŒ‰é’® ==================== */
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: var(--white);
            box-shadow: 0 5px 20px rgba(232, 180, 184, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(232, 180, 184, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--text-color);
            border: 2px solid var(--primary-color);
        }
        
        .btn-secondary:hover {
            background: var(--primary-color);
        }
        
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        /* ==================== è‰ç¨¿æç¤º ==================== */
        .draft-notice {
            background: rgba(232, 180, 184, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
        }
        
        .draft-icon {
            font-size: 1.5rem;
        }
        
        /* ==================== åŠ¨ç”» ==================== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        /* ==================== å“åº”å¼è®¾è®¡ ==================== */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .steps-indicator {
                padding: 20px 15px;
            }
            
            .step-circle {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .step-label {
                font-size: 0.75rem;
            }
            
            .form-card {
                padding: 25px 20px;
            }
            
            .step-title {
                font-size: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column-reverse;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .steps-track::before {
                left: 20px;
                right: 20px;
            }
            
            .step-progress {
                left: 20px;
            }
            
            .step-circle {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .step-label {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <a href="index.html" class="back-link">
                <span>â†</span>
                <span>è¿”å›é¦–é¡µ</span>
            </a>
            <h1 class="page-title">å¡«å†™é¢†å–ä¿¡æ¯</h1>
            <p class="page-subtitle">è¯·å¡«å†™æ‚¨çš„çœŸå®ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†å°½å¿«ä¸ºæ‚¨é…é€å–œç³–</p>
        </div>
        
        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
        <div class="steps-indicator">
            <div class="steps-track">
                <div class="step-progress" id="stepProgress"></div>
                <div class="step-item active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">åŸºæœ¬ä¿¡æ¯</div>
                </div>
                <div class="step-item" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">è”ç³»æ–¹å¼</div>
                </div>
                <div class="step-item" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">æ”¶è´§åœ°å€</div>
                </div>
                <div class="step-item" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">ç¡®è®¤æäº¤</div>
                </div>
            </div>
        </div>
        
        <!-- è¡¨å•å¡ç‰‡ -->
        <div class="form-card">
            <form id="candyForm" novalidate>
                <!-- ç¬¬1æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
                <div class="form-step active" data-step="1">
                    <h2 class="step-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h2>
                    <p class="step-description">è¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„åŸºæœ¬ä¿¡æ¯</p>
                    
                    <div class="draft-notice" id="draftNotice" style="display: none;">
                        <span class="draft-icon">ğŸ’¾</span>
                        <span>æ£€æµ‹åˆ°æœªå®Œæˆçš„è‰ç¨¿ï¼Œå·²è‡ªåŠ¨æ¢å¤</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="name" class="form-label">
                            å§“å <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-control"
                            placeholder="è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å"
                            required
                            autocomplete="name"
                        >
                        <span class="form-hint">2-20ä¸ªå­—ç¬¦ï¼Œæ”¯æŒä¸­æ–‡æˆ–è‹±æ–‡</span>
                        <span class="error-message" id="nameError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="relationship" class="form-label">
                            ä¸æ–°äººå…³ç³» <span class="required">*</span>
                        </label>
                        <select 
                            id="relationship" 
                            name="relationship" 
                            class="form-control"
                            required
                        >
                            <option value="">è¯·é€‰æ‹©æ‚¨ä¸æ–°äººçš„å…³ç³»</option>
                            <option value="family">å®¶äºº</option>
                            <option value="friend">æœ‹å‹</option>
                            <option value="colleague">åŒäº‹</option>
                            <option value="relative">äº²æˆš</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                        <span class="error-message" id="relationshipError"></span>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" id="step1Next">
                            ä¸‹ä¸€æ­¥ â†’
                        </button>
                    </div>
                </div>
                
                <!-- ç¬¬2æ­¥ï¼šè”ç³»æ–¹å¼ -->
                <div class="form-step" data-step="2">
                    <h2 class="step-title">ğŸ“ è”ç³»æ–¹å¼</h2>
                    <p class="step-description">è¯·æä¾›æ‚¨çš„è”ç³»æ–¹å¼ï¼Œä»¥ä¾¿æˆ‘ä»¬ä¸æ‚¨æ²Ÿé€š</p>
                    
                    <div class="form-group">
                        <label for="phone" class="form-label">
                            æ‰‹æœºå·ç  <span class="required">*</span>
                        </label>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            class="form-control"
                            placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
                            required
                            maxlength="11"
                            autocomplete="tel"
                        >
                        <span class="form-hint">ç”¨äºæ¥æ”¶é…é€é€šçŸ¥</span>
                        <span class="error-message" id="phoneError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="wechat" class="form-label">
                            å¾®ä¿¡å· <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="wechat" 
                            name="wechat" 
                            class="form-control"
                            placeholder="è¯·è¾“å…¥æ‚¨çš„å¾®ä¿¡å·"
                            required
                        >
                        <span class="form-hint">å­—æ¯å¼€å¤´ï¼Œ6-20ä½å­—ç¬¦</span>
                        <span class="error-message" id="wechatError"></span>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="step2Prev">
                            â† ä¸Šä¸€æ­¥
                        </button>
                        <button type="button" class="btn btn-primary" id="step2Next">
                            ä¸‹ä¸€æ­¥ â†’
                        </button>
                    </div>
                </div>
                
                <!-- ç¬¬3æ­¥ï¼šæ”¶è´§åœ°å€ -->
                <div class="form-step" data-step="3">
                    <h2 class="step-title">ğŸ“ æ”¶è´§åœ°å€</h2>
                    <p class="step-description">è¯·å¡«å†™å‡†ç¡®çš„æ”¶è´§åœ°å€</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="province" class="form-label">
                                çœä»½ <span class="required">*</span>
                            </label>
                            <select 
                                id="province" 
                                name="province" 
                                class="form-control"
                                required
                            >
                                <option value="">è¯·é€‰æ‹©çœä»½</option>
                            </select>
                            <span class="error-message" id="provinceError"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="city" class="form-label">
                                åŸå¸‚ <span class="required">*</span>
                            </label>
                            <select 
                                id="city" 
                                name="city" 
                                class="form-control"
                                required
                                disabled
                            >
                                <option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>
                            </select>
                            <span class="error-message" id="cityError"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="district" class="form-label">
                                åŒºå¿ <span class="required">*</span>
                            </label>
                            <select 
                                id="district" 
                                name="district" 
                                class="form-control"
                                required
                                disabled
                            >
                                <option value="">è¯·å…ˆé€‰æ‹©åŸå¸‚</option>
                            </select>
                            <span class="error-message" id="districtError"></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address" class="form-label">
                            è¯¦ç»†åœ°å€ <span class="required">*</span>
                        </label>
                        <textarea 
                            id="address" 
                            name="address" 
                            class="form-control"
                            placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€ï¼ˆè¡—é“ã€é—¨ç‰Œå·ã€æ¥¼æ ‹å•å…ƒç­‰ï¼‰"
                            required
                            rows="3"
                            autocomplete="street-address"
                        ></textarea>
                        <span class="form-hint">è‡³å°‘5ä¸ªå­—ç¬¦</span>
                        <span class="error-message" id="addressError"></span>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="zipcode" class="form-label">
                                é‚®æ”¿ç¼–ç  <span style="color: #999;">(é€‰å¡«)</span>
                            </label>
                            <input 
                                type="text" 
                                id="zipcode" 
                                name="zipcode" 
                                class="form-control"
                                placeholder="è¯·è¾“å…¥é‚®æ”¿ç¼–ç "
                                maxlength="6"
                                autocomplete="postal-code"
                            >
                            <span class="error-message" id="zipcodeError"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="deliveryTime" class="form-label">
                                æœŸæœ›é…é€æ—¶é—´ <span class="required">*</span>
                            </label>
                            <select 
                                id="deliveryTime" 
                                name="deliveryTime" 
                                class="form-control"
                                required
                            >
                                <option value="">è¯·é€‰æ‹©é…é€æ—¶é—´</option>
                                <option value="anytime">ä»»ä½•æ—¶é—´</option>
                                <option value="weekday">å·¥ä½œæ—¥</option>
                                <option value="weekend">å‘¨æœ«</option>
                                <option value="morning">ä¸Šåˆ(9:00-12:00)</option>
                                <option value="afternoon">ä¸‹åˆ(14:00-18:00)</option>
                            </select>
                            <span class="error-message" id="deliveryTimeError"></span>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="step3Prev">
                            â† ä¸Šä¸€æ­¥
                        </button>
                        <button type="button" class="btn btn-primary" id="step3Next">
                            ä¸‹ä¸€æ­¥ â†’
                        </button>
                    </div>
                </div>
                
                <!-- ç¬¬4æ­¥ï¼šç¡®è®¤æäº¤ -->
                <div class="form-step" data-step="4">
                    <h2 class="step-title">âœ… ç¡®è®¤æäº¤</h2>
                    <p class="step-description">è¯·ç¡®è®¤æ‚¨çš„ä¿¡æ¯æ— è¯¯</p>
                    
                    <div class="preview-card" id="previewCard">
                        <div class="preview-section">
                            <div class="preview-section-title">åŸºæœ¬ä¿¡æ¯</div>
                            <div class="preview-item">
                                <span class="preview-label">å§“åï¼š</span>
                                <span class="preview-value" id="previewName">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="preview-label">ä¸æ–°äººå…³ç³»ï¼š</span>
                                <span class="preview-value" id="previewRelationship">-</span>
                            </div>
                        </div>
                        
                        <div class="preview-section">
                            <div class="preview-section-title">è”ç³»æ–¹å¼</div>
                            <div class="preview-item">
                                <span class="preview-label">æ‰‹æœºå·ç ï¼š</span>
                                <span class="preview-value" id="previewPhone">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="preview-label">å¾®ä¿¡å·ï¼š</span>
                                <span class="preview-value" id="previewWechat">-</span>
                            </div>
                        </div>
                        
                        <div class="preview-section">
                            <div class="preview-section-title">æ”¶è´§åœ°å€</div>
                            <div class="preview-item">
                                <span class="preview-label">åœ°åŒºï¼š</span>
                                <span class="preview-value" id="previewRegion">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="preview-label">è¯¦ç»†åœ°å€ï¼š</span>
                                <span class="preview-value" id="previewAddress">-</span>
                            </div>
                            <div class="preview-item" id="previewZipcodeItem" style="display: none;">
                                <span class="preview-label">é‚®æ”¿ç¼–ç ï¼š</span>
                                <span class="preview-value" id="previewZipcode">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="preview-label">æœŸæœ›é…é€æ—¶é—´ï¼š</span>
                                <span class="preview-value" id="previewDeliveryTime">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="message" class="form-label">
                            ç¥ç¦ç•™è¨€ <span style="color: #999;">(é€‰å¡«)</span>
                        </label>
                        <textarea 
                            id="message" 
                            name="message" 
                            class="form-control"
                            placeholder="å†™ä¸‹æ‚¨å¯¹æ–°äººçš„ç¥ç¦å§~"
                            rows="4"
                            maxlength="200"
                        ></textarea>
                        <div class="char-counter">
                            <span id="messageCount">0</span> / 200
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input 
                            type="checkbox" 
                            id="privacy" 
                            name="privacy" 
                            class="checkbox-input"
                            required
                        >
                        <label for="privacy" class="checkbox-label">
                            æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="privacy.html" target="_blank">ã€Šéšç§æ”¿ç­–ã€‹</a>ï¼Œ
                            åŒæ„ç³»ç»Ÿæ”¶é›†å’Œä½¿ç”¨æˆ‘çš„ä¸ªäººä¿¡æ¯ç”¨äºå–œç³–é…é€ã€‚
                            <span class="required">*</span>
                        </label>
                    </div>
                    <span class="error-message" id="privacyError"></span>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="step4Prev">
                            â† ä¸Šä¸€æ­¥
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            æäº¤ä¿¡æ¯ âœ“
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- å¼•å…¥å¿…è¦çš„JSæ–‡ä»¶ -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/form-validator.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/region-loader.js"></script>
    
    <!-- åªåŠ è½½è¡¨å•å¿…éœ€çš„è„šæœ¬ -->
    <script src="js/config.min.js"></script>
    <script src="js/utils.min.js"></script>
    <script src="js/form-validator.js"></script>
    <script src="js/region-loader.js"></script>
    <script src="js/data-manager.min.js"></script>
    
    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let currentStep = 1;
        const totalSteps = 4;
        const DRAFT_KEY = 'wedding_form_draft';
        
        // å…³ç³»æ˜ å°„
        const relationshipMap = {
            'family': 'å®¶äºº',
            'friend': 'æœ‹å‹',
            'colleague': 'åŒäº‹',
            'relative': 'äº²æˆš',
            'other': 'å…¶ä»–'
        };
        
        // é…é€æ—¶é—´æ˜ å°„
        const deliveryTimeMap = {
            'anytime': 'ä»»ä½•æ—¶é—´',
            'weekday': 'å·¥ä½œæ—¥',
            'weekend': 'å‘¨æœ«',
            'morning': 'ä¸Šåˆ(9:00-12:00)',
            'afternoon': 'ä¸‹åˆ(14:00-18:00)'
        };
        
        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // åŠ è½½åŒºåŸŸæ•°æ®
                await RegionLoader.load();
                
                // åˆå§‹åŒ–çœå¸‚åŒºè”åŠ¨
                const provinceSelect = document.getElementById('province');
                const citySelect = document.getElementById('city');
                const districtSelect = document.getElementById('district');
                
                // å¡«å……çœä»½
                RegionLoader.populateProvinces(provinceSelect);
                
                // åˆå§‹åŒ–è”åŠ¨
                RegionLoader.initCascade({
                    province: provinceSelect,
                    city: citySelect,
                    district: districtSelect
                });
                
                // åŠ è½½è‰ç¨¿ï¼ˆå¯èƒ½åŒ…å«åœ°åŒºé€‰æ‹©ï¼‰
                loadDraft();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                initializeEventListeners();
                
                // æ›´æ–°æ­¥éª¤è¿›åº¦
                updateStepProgress();
                
            } catch (error) {
                console.error('Initialization error:', error);
                Utils.toast('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        });
        
        // çœå¸‚åŒºè”åŠ¨å·²é€šè¿‡ RegionLoader.initCascade() åˆå§‹åŒ–
        
        // ==================== äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ– ====================
        function initializeEventListeners() {
            // æ­¥éª¤å¯¼èˆª
            document.getElementById('step1Next').addEventListener('click', () => validateAndNext(1));
            document.getElementById('step2Prev').addEventListener('click', () => goToStep(1));
            document.getElementById('step2Next').addEventListener('click', () => validateAndNext(2));
            document.getElementById('step3Prev').addEventListener('click', () => goToStep(2));
            document.getElementById('step3Next').addEventListener('click', () => validateAndNext(3));
            document.getElementById('step4Prev').addEventListener('click', () => goToStep(3));
            
            // è¡¨å•æäº¤
            document.getElementById('candyForm').addEventListener('submit', handleSubmit);
            
            // å®æ—¶éªŒè¯
            addRealtimeValidation('name', validateName);
            addRealtimeValidation('relationship', validateRelationship);
            addRealtimeValidation('phone', validatePhone);
            addRealtimeValidation('wechat', validateWechat);
            addRealtimeValidation('address', validateAddress);
            addRealtimeValidation('zipcode', validateZipcode);
            addRealtimeValidation('deliveryTime', validateDeliveryTime);
            
            // ç•™è¨€å­—ç¬¦è®¡æ•°
            document.getElementById('message').addEventListener('input', function() {
                document.getElementById('messageCount').textContent = this.value.length;
            });
            
            // è‡ªåŠ¨ä¿å­˜è‰ç¨¿
            const formInputs = document.querySelectorAll('#candyForm input, #candyForm select, #candyForm textarea');
            formInputs.forEach(input => {
                input.addEventListener('change', saveDraft);
                input.addEventListener('input', Utils.debounce(saveDraft, 1000));
            });
            
            // æ­¥éª¤æŒ‡ç¤ºå™¨ç‚¹å‡»
            document.querySelectorAll('.step-item').forEach(item => {
                item.addEventListener('click', function() {
                    const targetStep = parseInt(this.dataset.step);
                    if (targetStep < currentStep) {
                        goToStep(targetStep);
                    }
                });
            });
        }
        
        // ==================== å®æ—¶éªŒè¯ ====================
        function addRealtimeValidation(fieldId, validationFn) {
            const field = document.getElementById(fieldId);
            if (!field) return;
            
            field.addEventListener('blur', () => validationFn());
            field.addEventListener('input', Utils.debounce(() => {
                if (field.value) validationFn();
            }, 500));
        }
        
        // ==================== å­—æ®µéªŒè¯å‡½æ•°ï¼ˆä½¿ç”¨FormValidatorï¼‰ ====================
        function validateName() {
            return FormValidator.validateDOMField(document.getElementById('name'));
        }
        
        function validateRelationship() {
            return FormValidator.validateDOMField(document.getElementById('relationship'));
        }
        
        function validatePhone() {
            return FormValidator.validateDOMField(document.getElementById('phone'));
        }
        
        function validateWechat() {
            return FormValidator.validateDOMField(document.getElementById('wechat'));
        }
        
        function validateField(fieldName) {
            const field = document.getElementById(fieldName);
            return FormValidator.validateDOMField(field);
        }
        
        function validateAddress() {
            return FormValidator.validateDOMField(document.getElementById('address'));
        }
        
        function validateZipcode() {
            return FormValidator.validateDOMField(document.getElementById('zipcode'));
        }
        
        function validateDeliveryTime() {
            return validateField('deliveryTime');
        }
        
        // ==================== æ­¥éª¤éªŒè¯å’Œå¯¼èˆª ====================
        function validateStep(step) {
            let isValid = true;
            
            switch(step) {
                case 1:
                    isValid = validateName() && validateRelationship();
                    break;
                case 2:
                    isValid = validatePhone() && validateWechat();
                    break;
                case 3:
                    isValid = validateField('province') && 
                              validateField('city') && 
                              validateField('district') && 
                              validateAddress() && 
                              validateZipcode() &&
                              validateDeliveryTime();
                    break;
            }
            
            return isValid;
        }
        
        function validateAndNext(step) {
            if (validateStep(step)) {
                if (step === 3) {
                    updatePreview();
                }
                goToStep(step + 1);
            } else {
                Utils.toast('è¯·æ£€æŸ¥è¡¨å•å¡«å†™', 'error');
            }
        }
        
        function goToStep(step) {
            // éšè—å½“å‰æ­¥éª¤
            document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step-item').forEach(s => s.classList.remove('active', 'completed'));
            
            // æ˜¾ç¤ºç›®æ ‡æ­¥éª¤
            document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            document.querySelectorAll('.step-item').forEach(item => {
                const itemStep = parseInt(item.dataset.step);
                if (itemStep === step) {
                    item.classList.add('active');
                } else if (itemStep < step) {
                    item.classList.add('completed');
                }
            });
            
            currentStep = step;
            updateStepProgress();
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function updateStepProgress() {
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            const progressBar = document.getElementById('stepProgress');
            progressBar.style.width = `calc(${progress}% - 25px)`;
        }
        
        // ==================== ä¿¡æ¯é¢„è§ˆ ====================
        function updatePreview() {
            const formData = getFormData();
            
            document.getElementById('previewName').textContent = formData.name;
            document.getElementById('previewRelationship').textContent = relationshipMap[formData.relationship] || formData.relationship;
            document.getElementById('previewPhone').textContent = Utils.formatPhone(formData.phone);
            document.getElementById('previewWechat').textContent = formData.wechat;
            document.getElementById('previewRegion').textContent = `${formData.province} ${formData.city} ${formData.district}`;
            document.getElementById('previewAddress').textContent = formData.address;
            document.getElementById('previewDeliveryTime').textContent = deliveryTimeMap[formData.deliveryTime] || formData.deliveryTime;
            
            if (formData.zipcode) {
                document.getElementById('previewZipcode').textContent = formData.zipcode;
                document.getElementById('previewZipcodeItem').style.display = 'flex';
            } else {
                document.getElementById('previewZipcodeItem').style.display = 'none';
            }
        }
        
        // ==================== è·å–è¡¨å•æ•°æ® ====================
        function getFormData() {
            const provinceSelect = document.getElementById('province');
            const citySelect = document.getElementById('city');
            const districtSelect = document.getElementById('district');
            
            return {
                name: document.getElementById('name').value.trim(),
                relationship: document.getElementById('relationship').value,
                phone: document.getElementById('phone').value.trim(),
                wechat: document.getElementById('wechat').value.trim(),
                province: provinceSelect.options[provinceSelect.selectedIndex]?.dataset.name || provinceSelect.value,
                city: citySelect.options[citySelect.selectedIndex]?.dataset.name || citySelect.value,
                district: districtSelect.options[districtSelect.selectedIndex]?.dataset.name || districtSelect.value,
                address: document.getElementById('address').value.trim(),
                zipcode: document.getElementById('zipcode').value.trim(),
                deliveryTime: document.getElementById('deliveryTime').value,
                message: document.getElementById('message').value.trim(),
                privacy: document.getElementById('privacy').checked
            };
        }
        
        // ==================== è‰ç¨¿ä¿å­˜å’ŒåŠ è½½ ====================
        function saveDraft() {
            const formData = getFormData();
            Utils.storage.set(DRAFT_KEY, {
                data: formData,
                step: currentStep,
                savedAt: new Date().toISOString()
            });
        }
        
        function loadDraft() {
            const draft = Utils.storage.get(DRAFT_KEY);
            
            if (draft && draft.data) {
                const data = draft.data;
                
                // æ¢å¤è¡¨å•æ•°æ®
                if (data.name) document.getElementById('name').value = data.name;
                if (data.relationship) document.getElementById('relationship').value = data.relationship;
                if (data.phone) document.getElementById('phone').value = data.phone;
                if (data.wechat) document.getElementById('wechat').value = data.wechat;
                
                // æ¢å¤åœ°åŒºé€‰æ‹©ï¼ˆä½¿ç”¨æ–°çš„åŒºåŸŸä»£ç ï¼‰
                if (data.province) {
                    const provinceCode = RegionLoader.getProvinceCode(data.province);
                    if (provinceCode) {
                        document.getElementById('province').value = provinceCode;
                        RegionLoader.populateCities(document.getElementById('city'), provinceCode);
                        
                        setTimeout(() => {
                            if (data.city) {
                                const cityCode = RegionLoader.getCityCode(provinceCode, data.city);
                                if (cityCode) {
                                    document.getElementById('city').value = cityCode;
                                    RegionLoader.populateDistricts(
                                        document.getElementById('district'), 
                                        provinceCode, 
                                        cityCode
                                    );
                                    
                                    setTimeout(() => {
                                        if (data.district) {
                                            const districtCode = RegionLoader.getDistrictCode(
                                                provinceCode, 
                                                cityCode, 
                                                data.district
                                            );
                                            if (districtCode) {
                                                document.getElementById('district').value = districtCode;
                                            }
                                        }
                                    }, 100);
                                }
                            }
                        }, 100);
                    }
                }
                
                if (data.address) document.getElementById('address').value = data.address;
                if (data.zipcode) document.getElementById('zipcode').value = data.zipcode;
                if (data.deliveryTime) document.getElementById('deliveryTime').value = data.deliveryTime;
                if (data.message) {
                    document.getElementById('message').value = data.message;
                    document.getElementById('messageCount').textContent = data.message.length;
                }
                
                // æ˜¾ç¤ºè‰ç¨¿æç¤º
                document.getElementById('draftNotice').style.display = 'flex';
            }
        }
        
        function clearDraft() {
            Utils.storage.remove(DRAFT_KEY);
        }
        
        // ==================== è¡¨å•æäº¤ ====================
        function handleSubmit(e) {
            e.preventDefault();
            
            const privacyCheckbox = document.getElementById('privacy');
            const privacyError = document.getElementById('privacyError');
            
            if (!privacyCheckbox.checked) {
                privacyError.textContent = 'è¯·é˜…è¯»å¹¶åŒæ„éšç§æ”¿ç­–';
                Utils.toast('è¯·åŒæ„éšç§æ”¿ç­–', 'error');
                return;
            }
            
            privacyError.textContent = '';
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-loading');
            submitBtn.textContent = 'æäº¤ä¸­...';
            
            // è·å–è¡¨å•æ•°æ®
            const formData = getFormData();
            
            // æ„é€ æäº¤æ•°æ®
            const submitData = {
                name: formData.name,
                phone: formData.phone,
                wechat: formData.wechat,
                relationship: formData.relationship,
                province: formData.province,
                city: formData.city,
                district: formData.district,
                address: formData.address,
                zipcode: formData.zipcode,
                deliveryTime: formData.deliveryTime,
                message: formData.message,
                fullAddress: `${formData.province} ${formData.city} ${formData.district} ${formData.address}${formData.zipcode ? ' (é‚®ç¼–:' + formData.zipcode + ')' : ''}`
            };
            
            // æ¨¡æ‹Ÿæäº¤å»¶è¿Ÿ
            setTimeout(() => {
                // æäº¤åˆ°æ•°æ®ç®¡ç†å™¨
                const result = DataManager.addRecipient(submitData);
                
                if (result.success) {
                    // æ¸…é™¤è‰ç¨¿
                    clearDraft();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    Utils.toast('æäº¤æˆåŠŸï¼', 'success');
                    
                    // è·³è½¬åˆ°æˆåŠŸé¡µé¢
                    setTimeout(() => {
                        window.location.href = 'success.html';
                    }, 500);
                } else {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('btn-loading');
                    submitBtn.textContent = 'æäº¤ä¿¡æ¯ âœ“';
                    Utils.toast(result.message, 'error');
                }
            }, 1000);
        }
    </script>
</body>
</html>
